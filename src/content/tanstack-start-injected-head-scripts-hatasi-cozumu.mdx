---
languages: ["tr"]
createdAt: "2026-02-03"
slug: "/tanstack-start-injected-head-scripts-hatasi-cozumu"
title: "TanStack Start: tanstack-start-injected-head-scripts HatasÄ± ve Ã‡Ã¶zÃ¼mÃ¼"
category: "teknik"
tags: ["TanStack", "TanStack Start", "Supabase", "Vite"]
medium: "https://medium.com/@omergulcicek/tanstack-start-tanstack-start-injected-head-scripts-hatas%C4%B1-ve-%C3%A7%C3%B6z%C3%BCm%C3%BC-69de117093a0"
---

ğŸ‡¬ğŸ‡§ **[Click to read the English version](/blog/tanstack-start-resolving-the-tanstack-start-injected-head-scripts-error)**

**Next.js** ile uzun sÃ¼re Ã§alÄ±ÅŸtÄ±ktan sonra, **type-safety** ve **streaming** odaklÄ± modern full-stack framework'Ã¼ olan **TanStack Start** ilgimi Ã§ekti. AslÄ±nda bu geÃ§iÅŸteki en bÃ¼yÃ¼k motivasyonum, daha Ã¶nce **TanStack Query** ve **TanStack Table** gibi kÃ¼tÃ¼phaneleri kullanmÄ±ÅŸ olmamdÄ±; bu araÃ§larÄ±n saÄŸladÄ±ÄŸÄ± harika geliÅŸtirici deneyimi ve baÅŸarÄ±dan Ã¶tÃ¼rÃ¼ ekosistemin yeni Ã¼yesi olan Start'Ä± da mutlaka Ã¶ÄŸrenmek istiyordum. UÃ§tan uca tip gÃ¼venliÄŸi, sunucu fonksiyonlarÄ± ve Vite tabanlÄ± hÄ±zlÄ± geliÅŸtirme dÃ¶ngÃ¼sÃ¼ gerÃ§ekten heyecan verici. Fakat **Supabase** ile bir oyun projesi geliÅŸtirirken karÅŸÄ±laÅŸtÄ±ÄŸÄ±m bir hata, bana hem teknik derinlik hem de "hazÄ±r cevap" tuzaÄŸÄ± hakkÄ±nda Ã¶nemli dersler verdi.

## Problem Senaryosu: Sayfa PatladÄ±, Konsol KÄ±pkÄ±rmÄ±zÄ±

Supabase kullanarak geliÅŸtirdiÄŸim sayfada bir anda her ÅŸey bozuldu. Sayfa yÃ¼klenirken konsolda ÅŸu hata belirdi:

```bash
[vite]: Rollup failed to resolve import "tanstack-start-injected-head-scripts:v"
from ".../node_modules/@tanstack/start-server-core/dist/esm/loadVirtualModule.js"
```

![tanstack-start-injected-head-scripts](/blog/2026-02-03/injected.png)

Bazen **Pre-transform error** olarak da gÃ¶rÃ¼nÃ¼yordu: `Failed to resolve import "tanstack-start-injected-head-scripts:v"`. GeliÅŸtirme ortamÄ±nda bazen sessiz kalÄ±yor, `vite build` ile production build alÄ±rken kesin ÅŸekilde patlÄ±yordu. Hata mesajÄ±, `@tanstack/start-server-core` iÃ§indeki sanal modÃ¼l Ã§Ã¶zÃ¼mlemesiyle ilgiliydi ve ilk bakÄ±ÅŸta framework veya Vite/Rollup tarafÄ±nda bir bug gibi gÃ¶rÃ¼nÃ¼yordu.

## AI ile Ã‡atÄ±ÅŸma: HalÄ±nÄ±n AltÄ±na SÃ¼pÃ¼rmek

Sorunu Ã§Ã¶zmek iÃ§in AI asistanlarÄ±na (ChatGPT, Gemini ve Cursor) danÄ±ÅŸtÄ±m. Ã–neriler genelde ÅŸu yÃ¶ndeydi:

- **Hata mesajÄ±nÄ± gizle:** `build.rollupOptions.external` veya Vite config iÃ§inde bu import'u external yap, uyarÄ±yÄ± kapat.
- **Hydration / script hatalarÄ±nÄ± yok say:** "Bu tÃ¼r hatalar bazen olur, suppress edebilirsin" tarzÄ± yorumlar.

Bu "Ã§Ã¶zÃ¼mler" sorunu Ã§Ã¶zmek yerine **halÄ±nÄ±n altÄ±na sÃ¼pÃ¼rmek**ti. Bir kez external / suppress yoluna girdiÄŸimde site inanÄ±lmaz yavaÅŸladÄ± ve davranÄ±ÅŸlar tutarsÄ±z hale geldi. Demek ki sorun, mesajÄ± gizlemekle deÄŸil, **kÃ¶k nedeni** bulmakla Ã§Ã¶zÃ¼lecekti.

Bu deneyim ÅŸunu netleÅŸtirdi: **DokÃ¼mantasyonu okumak ve elle debug yapmak, AI'Ä±n hazÄ±r cevaplarÄ±ndan Ã§oÄŸu zaman daha Ã¼stÃ¼n.** AI hÄ±zlÄ± bir baÅŸlangÄ±Ã§ noktasÄ± sunabilir ama kÃ¶k neden analizi ve mimari kararlar iÃ§in yetersiz kalabiliyor.

## Sorunun AsÄ±l KaynaÄŸÄ±: YanlÄ±ÅŸ Context, YanlÄ±ÅŸ Instance

Bu hata mesajÄ± bazen farklÄ± sebeplerden de Ã§Ä±kabilir; burada anlattÄ±ÄŸÄ±m Ã§Ã¶zÃ¼m, Supabase (veya benzeri bir client) ile server/client sÄ±nÄ±rÄ±nÄ±n karÄ±ÅŸtÄ±ÄŸÄ± senaryoya Ã¶zgÃ¼.

Hata mesajÄ± "injected head scripts" ve "virtual module" diye gÃ¶rÃ¼nse de, **asÄ±l problem framework deÄŸildi.** Problem, **Supabase (veya Clerk vb) client'Ä± ile sunucu tarafÄ± (server-side) bir sayfada aynÄ± fonksiyonun veya client Ã¶rneÄŸinin (instance) yanlÄ±ÅŸ context iÃ§inde kullanÄ±lmasÄ±ydÄ±.**

Yani:

- **Server** tarafÄ±nda Ã§alÄ±ÅŸmasÄ± gereken bir ÅŸey (veritabanÄ±, Supabase admin/client) **client** bundle'Ä±na karÄ±ÅŸÄ±yor veya client'tan doÄŸrudan Ã§aÄŸrÄ±lÄ±yordu.
- Ya da tam tersi: client-only bir instance, sunucu render path'inde kullanÄ±lÄ±yordu.

Bu karÄ±ÅŸÄ±klÄ±k, TanStack Start'un sanal modÃ¼l ve script enjeksiyonu mekanizmasÄ±nÄ± tetikliyor; Rollup/Vite da "tanstack-start-injected-head-scripts:v" modÃ¼lÃ¼nÃ¼ beklenen yerde bulamayÄ±nca build kÄ±rÄ±lÄ±yordu. Yani **semptom** "injected head scripts", **kÃ¶k neden** ise **server/client ayrÄ±mÄ±nÄ±n ihlali** idi.

### HatalÄ± KullanÄ±m

AynÄ± Supabase client Ã¶rneÄŸini veya veritabanÄ± Ã§aÄŸrÄ±larÄ±nÄ± hem sunucu hem istemci tarafÄ±nda kullanmak:

```ts
// âŒ HatalÄ±: Client ve server'da aynÄ± instance / aynÄ± fonksiyon
// Bu dosya client bundle'a da giriyor, server context'i karÄ±ÅŸÄ±yor
import { createClient } from "@supabase/supabase-js";

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

export async function getGameData(id: string) {
  const { data } = await supabase.from("games").select("*").eq("id", id).single();
  return data;
}
```

Bu fonksiyon veya client, client tarafÄ±nda da import edilip kullanÄ±lÄ±yorsa (Ã¶rneÄŸin bir sayfa bileÅŸeninde veya loader'da yanlÄ±ÅŸ yerde), TanStack Start'un server/client ayrÄ±mÄ± bozuluyor ve "injected head scripts" benzeri Ã§Ã¶zÃ¼mleme hatalarÄ± ortaya Ã§Ä±kabiliyor.

## GerÃ§ek Ã‡Ã¶zÃ¼m: Server/Client ArayÃ¼zÃ¼nÃ¼ Net AyÄ±r

**Client tarafÄ±nda**, sunucu fonksiyonlarÄ±nÄ± veya veritabanÄ± client'Ä±nÄ± doÄŸrudan import edip Ã§aÄŸÄ±rmayÄ±n. Bunun yerine:

1. **API / veritabanÄ± iÅŸlemlerini** yalnÄ±zca **server-side** bir dosyada tanÄ±mlayÄ±n (Ã¶rneÄŸin `createServerFn` veya sadece sunucuda Ã§alÄ±ÅŸan modÃ¼ller).
2. **Client tarafÄ±na** sadece **temiz bir arayÃ¼z** sunun: Ã¶rneÄŸin server fonksiyonlarÄ±nÄ± import edip kullanÄ±n; Supabase client'Ä± sadece sunucu kodunda oluÅŸturulup kullanÄ±lsÄ±n.

BÃ¶ylece client bundle'a server-only kod ve Supabase instance'Ä± karÄ±ÅŸmaz; TanStack Start'un sanal modÃ¼lleri de doÄŸru context'te Ã§Ã¶zÃ¼lÃ¼r.

### DoÄŸru KullanÄ±m

```ts
// âœ… DoÄŸru: Sadece server tarafÄ±nda Ã§alÄ±ÅŸan modÃ¼l
// Ã–rn: app/utils/db.server.ts veya server-only bir modÃ¼l
import { createClient } from "@supabase/supabase-js";

function getSupabaseServer() {
  return createClient(
    process.env.SUPABASE_URL!,
    process.env.SUPABASE_SERVICE_ROLE_KEY!
  );
}

export async function getGameData(id: string) {
  const supabase = getSupabaseServer();
  const { data } = await supabase.from("games").select("*").eq("id", id).single();
  return data;
}
```

```ts
// âœ… DoÄŸru: Client tarafÄ± sadece server fonksiyonunu Ã§aÄŸÄ±rÄ±r
// createServerFn ile sarÄ±lÄ± bir arayÃ¼z kullanÄ±n
import { createServerFn } from "@tanstack/start";
import { getGameData } from "./db.server";

export const fetchGameData = createServerFn().handler(async ({ data: { id } }) => {
  return getGameData(id);
});
```

Client bileÅŸenleri yalnÄ±zca `fetchGameData` gibi server fn'leri Ã§aÄŸÄ±rÄ±r; Supabase client'Ä± ve `getGameData` implementasyonu yalnÄ±zca sunucuda Ã§alÄ±ÅŸÄ±r. Bu ayrÄ±m hem `tanstack-start-injected-head-scripts` hatasÄ±nÄ± Ã§Ã¶zer hem de gÃ¼venlik ve performans aÃ§Ä±sÄ±ndan doÄŸru mimariyi kurar.

## Topluluk Etkisi

Bu analiz ve Ã§Ã¶zÃ¼mÃ¼ [GitHub'daki ilgili issue (#5196)](https://github.com/TanStack/router/issues/5196) altÄ±nda [yorum olarak paylaÅŸtÄ±m](https://github.com/TanStack/router/issues/5196#issuecomment-3690214286). AynÄ± hatayÄ± yaÅŸayan birÃ§ok geliÅŸtirici beÄŸeni bÄ±raktÄ±. Bu da gÃ¶steriyor ki sorun sadece "config'de bir satÄ±r" deÄŸil; **server/client sÄ±nÄ±rÄ±nÄ± doÄŸru kurmak** birÃ§ok TanStack Start + Supabase (veya benzeri backend) projesi iÃ§in kritik.

Ã–zetle: **TanStack Start ile Ã§alÄ±ÅŸÄ±rken "tanstack-start-injected-head-scripts" benzeri hatalar gÃ¶rdÃ¼ÄŸÃ¼nÃ¼zde, Ã¶nce server ve client tarafÄ±nda hangi instance'Ä±n nerede kullanÄ±ldÄ±ÄŸÄ±nÄ± kontrol edin.** Supabase (veya baÅŸka bir client) yalnÄ±zca sunucu tarafÄ±nda kullanÄ±lmalÄ±, client'a sadece server fonksiyonlarÄ± Ã¼zerinden temiz bir arayÃ¼z sunulmalÄ±. Bu hem hatayÄ± Ã§Ã¶zer hem de mimarinizi saÄŸlamlaÅŸtÄ±rÄ±r.
